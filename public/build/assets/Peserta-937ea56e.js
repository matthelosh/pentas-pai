import{r as a,q as W,o as h,c as b,b as e,F as j,l as S,t as p,e as L,u as _,y as M,d as R,i as F,j as U,K as G,n as Y,a as C,f as y,k as H,v as O,m as q,h as ee,w as te,Z as se,z as le,A as oe,B as E,O as J}from"./app-01791401.js";import{_ as ae}from"./Dash-4feebf60.js";import{r as ne,u as re}from"./xlsx-9d47e74b.js";import{b as ie,S as z,A as Z,c as de,d as ue}from"./mdi-c4c90586.js";import ce from"./DialogBox-f2932dbc.js";import{b as pe,c as Q}from"./chunk-7461cf73.js";import{i as X}from"./misc-66c4e50d.js";import{b as he,c as be,t as me,a as fe}from"./_baseIteratee-e1418dfa.js";import{i as ve}from"./isArrayLike-4aa94e85.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./isSymbol-80af4f08.js";import"./_baseIsEqual-61354f41.js";function _e(r){var d=r==null?0:r.length;return d?r[d-1]:void 0}function ge(r,d){return d.length<2?r:he(r,pe(d,0,-1))}function xe(r,d){return d=be(d,r),r=ge(r,d),r==null||delete r[me(_e(d))]}var ye=Array.prototype,ke=ye.splice;function we(r,d){for(var c=r?d.length:0,f=c-1;c--;){var m=d[c];if(c==f||m!==g){var g=m;ve(m)?ke.call(r,m,1):xe(r,m)}}return r}function $e(r,d){var c=[];if(!(r&&r.length))return c;var f=-1,m=[],g=r.length;for(d=fe(d);++f<g;){var P=r[f];d(P,f,r)&&(c.push(P),m.push(f))}return we(r,m),c}const Ce={class:"dialog min-w-[400px] min-h-[400px] rounded shadow bg-white"},je=e("h3",null,"Cek Calon Peserta",-1),Pe={class:"content p-3"},Ne={class:"table table-responsive w-full"},Se={class:"table w-full border-collapse"},Le=e("thead",null,[e("tr",null,[e("th",{class:"border text-center"},"No"),e("th",{class:"border text-center"},"NISN"),e("th",{class:"border text-center"},"Nama"),e("th",{class:"border text-center"},"JK"),e("th",{class:"border text-center"},"Sekolah"),e("th",{class:"border text-center"},"Lomba")])],-1),De={class:"border p-2"},Fe={class:"border p-2"},Ue={class:"border p-2"},Ve={class:"border p-2"},Ae={class:"border p-2"},Ie={class:"border p-2"},Be={class:"w-full bg-gray-200 flex items-center justify-between pl-3"},Ke={class:"flex items-center h-full flex-wrap"},Je=["onClick"],Oe={__name:"ImportTable",setup(r,{expose:d}){const c=a(!1),f=a(null),m=a(null),g=a("");a("Halo"),a(!1);const P=async()=>{await U.post(route("dashboard.peserta.impor"),{data:x.value}).then(s=>{c.value=!1,f.value(!0)}).catch(s=>console.log(s))};let x=a([]);const D=async(s,v)=>(c.value=!0,x.value=v,g.value=s,new Promise((u,$)=>{f.value=u,m.value=$})),k=a(1),w=W(()=>{x.value.length;let s=Q(x.value,10);return{current:s[k.value-1],pageCount:s.length}});return d({open:D}),(s,v)=>c.value?(h(),b("div",{key:0,class:"overlay fixed top-0 right-0 bottom-0 left-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",onClick:v[2]||(v[2]=R(u=>c.value=!1,["self"]))},[e("div",Ce,[e("div",{class:"toolbar bg-gray-100 flex items-center justify-between p-2"},[je,e("div",{class:"item-toolbars"},[e("button",{class:"py-1 px-2 rounded bg-sky-400 text-white hover:bg-sky-600 active:bg-orange-400 transition-all duration-150 delay-50",onClick:P},"Impor")])]),e("div",Pe,[e("div",Ne,[e("table",Se,[Le,e("tbody",null,[(h(!0),b(j,null,S(_(w).current,(u,$)=>(h(),b("tr",{class:"odd:bg-gray-50",key:$},[e("td",De,p($+1),1),e("td",Fe,p(u.nisn),1),e("td",Ue,p(u.nama),1),e("td",Ve,p(u.jk),1),e("td",Ae,p(u.sekolah_id),1),e("td",Ie,[L(" | "+p(u.lomba_id)+" ",1),e("ul",null,[(h(!0),b(j,null,S(u.bidangs,(V,A)=>(h(),b("li",{key:A},p(V.label),1))),128))])])]))),128))])]),e("div",Be,[L(" Jml Halaman: "+p(_(w).pageCount)+" ",1),e("div",Ke,[e("button",{onClick:v[0]||(v[0]=u=>k.value-=1),class:"flex justify-center w-8 border border-gray-500"},"<"),(h(!0),b(j,null,S(_(w).pageCount,u=>(h(),b("button",{key:u,class:M(["flex justify-center w-8 border border-gray-500",u==k.value?"bg-sky-600 text-white":""]),onClick:$=>k.value=u},p(u),11,Je))),128)),e("button",{onClick:v[1]||(v[1]=u=>k.value+=1),class:"flex justify-center w-8 border border-gray-500"},">")])])])])])])):F("",!0)}},Te=["onClick"],Me={class:"grid grid-cols-1 md:grid-cols-2 md:p-10 md:gap-5 relative bg-gray-50 w-[90vw] h-90vh md:w-2/4"},Re={class:"w-full bg-gray-200 p-3 mb-0 md:mb-3 rounded flex flex-col justify-center items-center relative md:static"},ze=["src"],He=e("h1",{class:"text-center text-gray-500 text-lg"},[e("span",{class:"hidden"},[L("Foto Peserta"),e("br")]),e("small",{class:"text-black"},"[Klik gambar untuk mengganti]")],-1),qe=["onSubmit"],Ee=e("h3",{class:"text-lg text-gray-700 mt-0 mb-4 font-extrabold"},"Data Peserta",-1),We={class:"flex justify-between mb-3"},Ge=e("label",{for:"sekolah"},"Sekolah",-1),Ze=["value"],Qe={class:"flex justify-between mb-3"},Xe=e("label",{for:"nisn",class:"w-1/4"},"NISN",-1),Ye={class:"flex justify-between mb-3"},et=e("label",{for:"nama",class:"w-1/4"},"Nama",-1),tt={class:"flex justify-between mb-3"},st=e("label",{for:"jk",class:"w-1/4"},"JK",-1),lt={class:"grid grid-cols-2 w-3/4"},ot=e("label",{for:"lk",class:"ml-2"},"Laki-laki",-1),at=e("label",{for:"pr",class:"ml-2"},"Perempuan",-1),nt={class:"flex justify-between mb-3"},rt=e("label",{for:"lomba"},"Lomba",-1),it=["value","selected"],dt={class:"flex justify-between mb-3"},ut=e("label",{for:"hp",class:"w-1/4"},"No. WA",-1),ct={class:"flex justify-center mb-3"},pt=["disabled"],ht={__name:"FormPeserta",setup(r,{expose:d}){G();const c=a(null),f=a("/img/peserta.png"),m=a(!1),g=a("edit"),P=i=>{let n=i.target.files[0];f.value=URL.createObjectURL(n),c.value=n},x=a([]),D=a([]),k=a(),w=a(!1),s=a({lomba_id:[]}),v=a(null),u=a(null),$=()=>{w.value=!1},V=i=>(w.value=!0,i!==null?(g.value="edit",s.value={id:i.id,nisn:i.nisn,nama:i.nama,jk:i.jk,sekolah_id:i.sekolah_id,foto:i.foto,hp:i.hp,lomba_id:[]},i.lomba_id.includes(",")?s.value.lomba_id=i.lomba_id.split(","):s.value.lomba_id.push(i.lomba_id),f.value=X(i.foto?i.foto:"/img/peserta.png")):(g.value="new",s.value={lomba_id:[]},f.value="/img/peserta.png"),new Promise((n,t)=>{v.value=n,u.value=t})),A=async()=>{m.value=!0;const i=g.value=="edit"?"dashboard.peserta.update":"peserta.store";let n=new FormData;n.append("data",JSON.stringify(s.value)),c.value!==null&&n.append("foto",c.value),await U.post(route(i,{id:s.value.id}),n).then(t=>{m.value=!1,u.value(!0),w.value=!1}).catch(t=>{m.value=!1,alert("Ada yang salah")})};d({open:V});const B=()=>{U.post(route("bidang.index")).then(i=>{x.value=i.data.bidangs})},T=()=>{U.post(route("sekolah.index")).then(i=>{D.value=i.data.sekolahs})};return Y(()=>{B(),T()}),(i,n)=>w.value?(h(),b("div",{key:0,class:"fixed top-0 right-0 bottom-0 left-0 bg-[#33333389] flex items-center justify-center z-50",onClick:R($,["self"])},[e("div",Me,[e("div",Re,[C(_(z),{type:"mdi",path:_(ie),class:"absolute w-10 text-gray-400 hover:text-gray-600 active:text-white top-4 right-2",onClick:$},null,8,["path"]),e("img",{src:f.value,alt:"Peserta",class:"w-1/2 rounded-full aspect-square object-cover object-top mx-auto shadow transition-all duration-500 hover:shadow-lg hover:shadow-lime-600 cursor-pointer bg-[#fefefe]",onClick:n[0]||(n[0]=t=>i.$refs.foto.click())},null,8,ze),He,e("input",{type:"file",ref:"foto",class:"hidden",onChange:P},null,544)]),e("form",{ref_key:"formRegistrasi",ref:k,onSubmit:R(A,["prevent"]),class:"p-2 h-auto"},[Ee,e("div",We,[Ge,y(e("select",{name:"sekolah",class:"rounded-lg w-3/4 p-1 placeholder:text-blue-500 focus:border-blue-500 bg-gray-100",placeholder:"Pilih","onUpdate:modelValue":n[1]||(n[1]=t=>s.value.sekolah_id=t)},[(h(!0),b(j,null,S(D.value,(t,o)=>(h(),b("option",{key:o,value:t.npsn},p(t.nama),9,Ze))),128))],512),[[H,s.value.sekolah_id]])]),e("div",Qe,[Xe,y(e("input",{type:"text",name:"nisn",class:"rounded-lg w-3/4 p-1 placeholder:text-blue-500 focus:border-blue-500 bg-gray-100",placeholder:"Nomor Induk Siswa Nasional","onUpdate:modelValue":n[2]||(n[2]=t=>s.value.nisn=t)},null,512),[[O,s.value.nisn]])]),e("div",Ye,[et,y(e("input",{type:"text",name:"nama",class:"rounded-lg w-3/4 p-1 placeholder:text-blue-500 focus:border-blue-500 bg-gray-100",placeholder:"Nama Lengkap","onUpdate:modelValue":n[3]||(n[3]=t=>s.value.nama=t)},null,512),[[O,s.value.nama]])]),e("div",tt,[st,e("div",lt,[e("span",null,[y(e("input",{type:"radio",name:"jk",value:"Laki-laki",id:"lk","onUpdate:modelValue":n[4]||(n[4]=t=>s.value.jk=t)},null,512),[[q,s.value.jk]]),ot]),e("span",null,[y(e("input",{type:"radio",name:"jk",value:"Perempuan",id:"pr","onUpdate:modelValue":n[5]||(n[5]=t=>s.value.jk=t)},null,512),[[q,s.value.jk]]),at])])]),e("div",nt,[rt,y(e("select",{name:"lomba",class:"rounded-lg w-3/4 p-1 placeholder:text-blue-500 focus:border-blue-500 bg-gray-100",placeholder:"Pilih","onUpdate:modelValue":n[6]||(n[6]=t=>s.value.lomba_id=t),multiple:""},[(h(!0),b(j,null,S(x.value,(t,o)=>(h(),b("option",{key:o,value:t.kode,selected:t.kode==s.value.lomba_id},p(t.label),9,it))),128))],512),[[H,s.value.lomba_id]])]),e("div",dt,[ut,y(e("input",{type:"text",name:"hp",class:"rounded-lg w-3/4 p-1 placeholder:text-blue-500 focus:border-blue-500 bg-gray-100",placeholder:"Nomor WA/HP","onUpdate:modelValue":n[7]||(n[7]=t=>s.value.hp=t)},null,512),[[O,s.value.hp]])]),e("div",ct,[e("button",{type:"submit",class:"bg-blue-600 text-white rounded px-3 py-1 hover:bg-blue-800 flex items-center disabled:bg-blue-300 disabled:text-gray-300",disabled:m.value},[m.value?(h(),ee(_(Z),{key:0,class:"animate-spin w-5 mr-1"})):F("",!0),L(" Daftar ")],8,pt)])],40,qe)])],8,Te)):F("",!0)}},bt={class:"w-full bg-white"},mt={class:"toolbar w-full h-12 bg-gray-50 rounded shadow flex items-center px-0 md:px-3 justify-center md:justify-between print:hidden"},ft=e("h1",{class:"hidden md:inline"},[e("span",null,"Data Peserta")],-1),vt={class:"toolbar-items flex items-center gap-2"},_t={for:"select",class:"mx-3 hidden md:inline"},gt={class:"hidden md:inline"},xt=["disabled"],yt={key:0,class:"hidden md:inline"},kt=["onKeyup"],wt={class:"content w-full bg-white p-3 mt-2"},$t={class:"overflow-x-auto w-full border"},Ct={class:"w-full table table-responsive border-collapse"},jt=e("caption",{class:"text-left md:text-center p-2"},[e("h1",{class:"text-xl"},"Data Peserta Lomba")],-1),Pt={class:"border text-center"},Nt=e("th",{class:"border text-center"},"NISN",-1),St=e("th",{class:"border text-center"},"Nama",-1),Lt=e("th",{class:"border text-center"},"JK",-1),Dt=e("th",{class:"border text-center"},"Sekolah",-1),Ft=e("th",{class:"border text-center"},"Lomba",-1),Ut=e("th",{class:"border text-center print:hidden"},"Opsi",-1),Vt={class:"border p-2"},At=["checked","onChange"],It={class:"border p-2"},Bt={class:"border p-2"},Kt=["onClick"],Jt=["src"],Ot={class:"border p-2"},Tt={class:"border p-2"},Mt={class:"border p-2 flex gap-2"},Rt={class:"bg-teal-200 px-2 py-1 rounded"},zt={class:"text-center border p-2 print:hidden"},Ht=["onClick"],qt={class:"w-full bg-gray-200 flex items-center justify-between px-3 flex-wrap print:hidden"},Et={class:"flex items-center gap-1"},Wt={class:"w-full flex flex-wrap md:justify-end print:hidden"},Gt=["onClick"],ds={__name:"Peserta",setup(r){const d=G(),c=a(1),f=a(null),m=a(d.props.pesertas),g=a(!1),P=()=>{m.value=d.props.pesertas.filter(t=>t.nama.toLowerCase().includes(f.value.toLowerCase())||t.nisn.toLowerCase().includes(f.value.toLowerCase())||t.sekolah.nama.toLowerCase().includes(f.value.toLowerCase()))},x=W(()=>{let t=m.value.length,o=Q(m.value,10);return{current:o[c.value-1],pageCount:o.length,total:t}}),D=async()=>{g.value=!0,await U.post(route("dashboard.peserta.attach"),{pesertas:JSON.stringify(d.props.pesertas)}).then(t=>{J.reload({only:["pesertas"]}),g.value=!1})},k=a("Ambil File"),w=async t=>{let o=t.target.files[0];k.value=o.name;let l=new FileReader;l.onload=async I=>{let N=await ne(I.target.result),K=await re.sheet_to_json(N.Sheets[N.SheetNames[0]]);await s.value.open("Cek Calon Peserta",K).then(Zt=>{J.reload({only:["pesertas"]})})},l.readAsArrayBuffer(o)},s=a(null),v=a(!1),u=a([]),$=t=>{u.value=t.target.checked?m.value:[]},V=t=>u.value.filter(l=>l.nisn==t).length>0,A=(t,o)=>{t.target.checked?u.value.push(o):u.value=$e(u.value,l=>l.nisn==o.nisn)},B=a(null),T=async t=>{await B.value.open("Hapus").then(o=>{o&&U.delete(route("dashboard.peserta.destroy",{id:t})).then(l=>{J.reload({only:["pesertas"]})})})},i=a(null),n=async t=>{await i.value.open(t).then(o=>{o&&J.reload({only:["pesertas"]})})};return(t,o)=>(h(),b(j,null,[C(ht,{ref_key:"formPeserta",ref:i},null,512),C(ce,{ref_key:"dialog",ref:B},null,512),C(Oe,{ref_key:"importTable",ref:s},null,512),C(_(se),{title:"Data Peserta"}),C(ae,null,{default:te(()=>[e("div",bt,[e("div",mt,[ft,e("div",vt,[e("input",{type:"file",name:"filePeserta",id:"filePeserta",ref:"filePeserta",onChange:w,class:"hidden",accept:".xlsx, .xls, .ods, .csv"},null,544),e("label",_t,[y(e("input",{type:"checkbox",name:"select",id:"select",class:"rounded","onUpdate:modelValue":o[0]||(o[0]=l=>v.value=l)},null,512),[[le,v.value]]),L(" Pilih Data ")]),e("button",{class:"bg-green-400 hover:bg-green-600 active:bg-orange-400 text-white py-1 px-2 rounded",onClick:o[1]||(o[1]=l=>n(null))},"Baru"),e("button",{class:"bg-green-400 hover:bg-green-600 active:bg-orange-400 text-white py-1 px-2 rounded flex items-center",onClick:o[2]||(o[2]=l=>t.$refs.filePeserta.click())},[e("span",gt,p(k.value),1),C(_(z),{type:"mdi",path:_(de)},null,8,["path"])]),e("button",{class:"bg-sky-400 hover:bg-sky-600 text-white px-2 py-1 rounded shadow uppercase flex items-center active:bg-sky-800",disabled:g.value,onClick:D},[g.value?F("",!0):(h(),b("span",yt,"Daftarkan Bidang Lomba")),C(_(Z),{class:M(["w-6 text-white",g.value?"animate-spin":""])},null,8,["class"])],8,xt),y(e("input",{type:"text",placeholder:"Cari",class:"h-8 rounded w-[60%] md:w-64","onUpdate:modelValue":o[3]||(o[3]=l=>f.value=l),onKeyup:oe(P,["enter"])},null,40,kt),[[O,f.value]])])]),e("div",wt,[e("div",$t,[e("table",Ct,[jt,e("thead",null,[e("tr",null,[e("th",Pt,[y(e("span",null,"No",512),[[E,!v.value]]),v.value?(h(),b("input",{key:0,type:"checkbox",name:"select",id:"select",class:"rounded",onChange:$},null,32)):F("",!0)]),Nt,St,Lt,Dt,Ft,Ut])]),e("tbody",null,[(h(!0),b(j,null,S(_(x).current,(l,I)=>(h(),b("tr",{class:"odd:bg-gray-50",key:I},[e("td",Vt,[y(e("span",null,p(I+1),513),[[E,!v.value]]),v.value?(h(),b("input",{key:0,type:"checkbox",name:"select",id:"select",class:"rounded",checked:V(l.nisn),onChange:N=>A(N,l)},null,40,At)):F("",!0)]),e("td",It,p(l.nisn),1),e("td",Bt,[e("div",{class:"h-full grid grid-cols-2 md:flex items-center gap-2 cursor-pointer",onClick:N=>n(l)},[e("img",{src:_(X)(l.foto),alt:"Foto",class:"h-8 aspect-square object-cover object-top rounded-full"},null,8,Jt),L(" "+p(l.nama),1)],8,Kt)]),e("td",Ot,p(l.jk),1),e("td",Tt,p(l.sekolah.nama),1),e("td",Mt,[e("div",Rt,p(l.lomba_id),1),e("ul",null,[(h(!0),b(j,null,S(l.bidangs,(N,K)=>(h(),b("li",{key:K},p(K+1)+". "+p(N.label),1))),128))])]),e("td",zt,[e("button",{class:"p-0 text-red-400 hover:text-red-600 active:text-orange-400",onClick:N=>T(l.id)},[C(_(z),{type:"mdi",path:_(ue),size:18},null,8,["path"])],8,Ht)])]))),128))])])]),e("div",qt,[e("div",Et," Total: "+p(_(x).total),1),L(" Jml Halaman: "+p(_(x).pageCount),1)]),e("div",Wt,[e("button",{onClick:o[4]||(o[4]=l=>c.value-=1),class:"flex justify-center w-8 border border-gray-500 flex-grow md:flex-grow-0"},"<"),(h(!0),b(j,null,S(_(x).pageCount,l=>(h(),b("button",{key:l,class:M(["flex justify-center w-8 border border-gray-500 flex-grow md:flex-grow-0",l==c.value?"bg-sky-600 text-white":""]),onClick:I=>c.value=l},p(l),11,Gt))),128)),e("button",{onClick:o[5]||(o[5]=l=>c.value+=1),class:"flex justify-center w-8 border border-gray-500 flex-grow md:flex-grow-0"},">")])])])]),_:1})],64))}};export{ds as default};
